## NgRx Rule: State


**NgRx Store** (хранилище) хранит в себе глобальное состояние Angular приложения в виде одного большого объекта.
В приложении может быть только одно хранилище.
Формирование глобального состояния в **NgRx Store** происходит путем объединения более мелких состояний, которые 
возвращают зарегистрированные в приложении редьюсеры.

**State** - более мелкое состояние, регистрируемое в редьюсере, то есть состояние данных отдельного справочника, страницы, 
фильтра, диалогового окна или других частей приложения.

Расположение: _src/modules/root/store/states_

Все **State'ы** нужно зарегистрировать в app.state в соответствии с алфавитным порядком. Располагается там же, 
где **State'ы**.

#### Популярные поля в State'е:

- ```readonly loading: boolean;```

  Флаг, указывающий на то, что загрузка данных, с которыми связано состояние, находится в процессе. На основании этого 
поля часто создается селектор флага загрузки данных состояния.
- ```readonly error: ApiResponse;``` 

  Ошибка, возникшая при загрузке данных, с которыми связано состояние или при выполнении какого-либо запроса, связанного
с этими данными.
  (```return !!state.error;```).
- Уникальные для диалоговых окон: `opened` (открыт ли диалог), `pending` (Находится ли в процессе выполнения действие, 
для которого предназначен диалог).

#### Особенности State'ов:

- Изменять поля состояния можно только в reducer'ах в ответ на какое-либо событие. 

- Данные, которые меняются в компонентах, лучше всего менять через событие и через изменение **state'а** (тупой 
компонент не меняет входящие данные, он передает событие изменения входящих данных в умный компонент, тот бросает 
событие в **Store**, данные меняются в reducer'е, а затем через селектор в умном компоненте снова попадают в тупой 
компонент).

- **State** не должен содержать "тяжелые" объекты, например файлы (для таких ситуаций предусмотрен сервис кеширования 
файлов).

- **State** должен быть логически правильным. Не стоит перегружать state различными данными, для каждых данных лучше 
создать свой **state**. Например, в состояние реестра не стоит добавлять информацию о фильтрациях реестра, так как 
такой **state** будет перегружен. Нужно создать отдельное состояние для фильтров реестра.

- State обычно не хранит флаг `loaded`, он определяется в селекторе на основании наличия данных в состоянии.

#### Правила инициализации значений в State'ах:

- для `boolean` полей - `false`;
- для `error` и других полей с типом _ApiResponse_ - `null`;
- для других данных состояния - `undefined`;
